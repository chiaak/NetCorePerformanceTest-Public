using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography;
using System.Text;
using System.Threading.Tasks;

namespace NetCorePerformanceTest.SpanTest
{
    public class CryptSpan
    {

        #region // Dictionary Mapping 
        private static Dictionary<byte, char[]> mapEncodeSpan = new Dictionary<byte, char[]>()
        {
            { 0,new char[3]{'0','0','0' } },{ 1,new char[3]{'0','0','1' }},{ 2,new char[3]{'0','0','2' }},{ 3,new char[3]{'0','0','3' }},
            { 4,new char[3]{'0','0','4' }},{ 5,new char[3]{'0','0','5' }},{ 6,new char[3]{'0','0','6' }},{ 7,new char[3]{'0','0','7' }},
            { 8,new char[3]{'0','0','8' }},{ 9,new char[3]{'0','0','9' }},{ 10,new char[3]{'0','1','0' }},{ 11,new char[3]{'0','1','1' }},
            { 12,new char[3]{'0','1','2' }},{ 13,new char[3]{'0','1','3' }},{ 14,new char[3]{'0','1','4' }},{ 15,new char[3]{'0','1','5' }},
            { 16,new char[3]{'0','1','6' }},{ 17,new char[3]{'0','1','7' }},{ 18,new char[3]{'0','1','8' }},{ 19,new char[3]{'0','1','9' }},
            { 20,new char[3]{'0','2','0' }},{ 21,new char[3]{'0','2','1' }},{ 22,new char[3]{'0','2','2' }},{ 23,new char[3]{'0','2','3' }},
            { 24,new char[3]{'0','2','4' }},{ 25,new char[3]{'0','2','5' }},{ 26,new char[3]{'0','2','6' }},{ 27,new char[3]{'0','2','7' }},
            { 28,new char[3]{'0','2','8' }},{ 29,new char[3]{'0','2','9' }},{ 30,new char[3]{'0','3','0' }},{ 31,new char[3]{'0','3','1' }},
            { 32,new char[3]{'0','3','2' }},{ 33,new char[3]{'0','3','3' }},{ 34,new char[3]{'0','3','4' }},{ 35,new char[3]{'0','3','5' }},
            { 36,new char[3]{'0','3','6' }},{ 37,new char[3]{'0','3','7' }},{ 38,new char[3]{'0','3','8' }},{ 39,new char[3]{'0','3','9' }},
            { 40,new char[3]{'0','4','0' }},{ 41,new char[3]{'0','4','1' }},{ 42,new char[3]{'0','4','2' }},{ 43,new char[3]{'0','4','3' }},
            { 44,new char[3]{'0','4','4' }},{ 45,new char[3]{'0','4','5' }},{ 46,new char[3]{'0','4','6' }},{ 47,new char[3]{'0','4','7' }},
            { 48,new char[3]{'0','4','8' }},{ 49,new char[3]{'0','4','9' }},{ 50,new char[3]{'0','5','0' }},{ 51,new char[3]{'0','5','1' }},
            { 52,new char[3]{'0','5','2' }},{ 53,new char[3]{'0','5','3' }},{ 54,new char[3]{'0','5','4' }},{ 55,new char[3]{'0','5','5' }},
            { 56,new char[3]{'0','5','6' }},{ 57,new char[3]{'0','5','7' }},{ 58,new char[3]{'0','5','8' }},{ 59,new char[3]{'0','5','9' }},
            { 60,new char[3]{'0','6','0' }},{ 61,new char[3]{'0','6','1' }},{ 62,new char[3]{'0','6','2' }},{ 63,new char[3]{'0','6','3' }},
            { 64,new char[3]{'0','6','4' }},{ 65,new char[3]{'0','6','5' }},{ 66,new char[3]{'0','6','6' }},{ 67,new char[3]{'0','6','7' }},
            { 68,new char[3]{'0','6','8' }},{ 69,new char[3]{'0','6','9' }},{ 70,new char[3]{'0','7','0' }},{ 71,new char[3]{'0','7','1' }},
            { 72,new char[3]{'0','7','2' }},{ 73,new char[3]{'0','7','3' }},{ 74,new char[3]{'0','7','4' }},{ 75,new char[3]{'0','7','5' }},
            { 76,new char[3]{'0','7','6' }},{ 77,new char[3]{'0','7','7' }},{ 78,new char[3]{'0','7','8' }},{ 79,new char[3]{'0','7','9' }},
            { 80,new char[3]{'0','8','0' }},{ 81,new char[3]{'0','8','1' }},{ 82,new char[3]{'0','8','2' }},{ 83,new char[3]{'0','8','3' }},
            { 84,new char[3]{'0','8','4' }},{ 85,new char[3]{'0','8','5' }},{ 86,new char[3]{'0','8','6' }},{ 87,new char[3]{'0','8','7' }},
            { 88,new char[3]{'0','8','8' }},{ 89,new char[3]{'0','8','9' }},{ 90,new char[3]{'0','9','0' }},{ 91,new char[3]{'0','9','1' }},
            { 92,new char[3]{'0','9','2' }},{ 93,new char[3]{'0','9','3' }},{ 94,new char[3]{'0','9','4' }},{ 95,new char[3]{'0','9','5' }},
            { 96,new char[3]{'0','9','6' }},{ 97,new char[3]{'0','9','7' }},{ 98,new char[3]{'0','9','8' }},{ 99,new char[3]{'0','9','9' }},
            { 100,new char[3]{'1','0','0' }},{ 101,new char[3]{'1','0','1' }},{ 102,new char[3]{'1','0','2' }},{ 103,new char[3]{'1','0','3' }},
            { 104,new char[3]{'1','0','4' }},{ 105,new char[3]{'1','0','5' }},{ 106,new char[3]{'1','0','6' }},{ 107,new char[3]{'1','0','7' }},
            { 108,new char[3]{'1','0','8' }},{ 109,new char[3]{'1','0','9' }},{ 110,new char[3]{'1','1','0' }},{ 111,new char[3]{'1','1','1' }},
            { 112,new char[3]{'1','1','2' }},{ 113,new char[3]{'1','1','3' }},{ 114,new char[3]{'1','1','4' }},{ 115,new char[3]{'1','1','5' }},
            { 116,new char[3]{'1','1','6' }},{ 117,new char[3]{'1','1','7' }},{ 118,new char[3]{'1','1','8' }},{ 119,new char[3]{'1','1','9' }},
            { 120,new char[3]{'1','2','0' }},{ 121,new char[3]{'1','2','1' }},{ 122,new char[3]{'1','2','2' }},{ 123,new char[3]{'1','2','3' }},
            { 124,new char[3]{'1','2','4' }},{ 125,new char[3]{'1','2','5' }},{ 126,new char[3]{'1','2','6' }},{ 127,new char[3]{'1','2','7' }},
            { 128,new char[3]{'1','2','8' }},{ 129,new char[3]{'1','2','9' }},{ 130,new char[3]{'1','3','0' }},{ 131,new char[3]{'1','3','1' }},
            { 132,new char[3]{'1','3','2' }},{ 133,new char[3]{'1','3','3' }},{ 134,new char[3]{'1','3','4' }},{ 135,new char[3]{'1','3','5' }},
            { 136,new char[3]{'1','3','6' }},{ 137,new char[3]{'1','3','7' }},{ 138,new char[3]{'1','3','8' }},{ 139,new char[3]{'1','3','9' }},
            { 140,new char[3]{'1','4','0' }},{ 141,new char[3]{'1','4','1' }},{ 142,new char[3]{'1','4','2' }},{ 143,new char[3]{'1','4','3' }},
            { 144,new char[3]{'1','4','4' }},{ 145,new char[3]{'1','4','5' }},{ 146,new char[3]{'1','4','6' }},{ 147,new char[3]{'1','4','7' }},
            { 148,new char[3]{'1','4','8' }},{ 149,new char[3]{'1','4','9' }},{ 150,new char[3]{'1','5','0' }},{ 151,new char[3]{'1','5','1' }},
            { 152,new char[3]{'1','5','2' }},{ 153,new char[3]{'1','5','3' }},{ 154,new char[3]{'1','5','4' }},{ 155,new char[3]{'1','5','5' }},
            { 156,new char[3]{'1','5','6' }},{ 157,new char[3]{'1','5','7' }},{ 158,new char[3]{'1','5','8' }},{ 159,new char[3]{'1','5','9' }},
            { 160,new char[3]{'1','6','0' }},{ 161,new char[3]{'1','6','1' }},{ 162,new char[3]{'1','6','2' }},{ 163,new char[3]{'1','6','3' }},
            { 164,new char[3]{'1','6','4' }},{ 165,new char[3]{'1','6','5' }},{ 166,new char[3]{'1','6','6' }},{ 167,new char[3]{'1','6','7' }},
            { 168,new char[3]{'1','6','8' }},{ 169,new char[3]{'1','6','9' }},{ 170,new char[3]{'1','7','0' }},{ 171,new char[3]{'1','7','1' }},
            { 172,new char[3]{'1','7','2' }},{ 173,new char[3]{'1','7','3' }},{ 174,new char[3]{'1','7','4' }},{ 175,new char[3]{'1','7','5' }},
            { 176,new char[3]{'1','7','6' }},{ 177,new char[3]{'1','7','7' }},{ 178,new char[3]{'1','7','8' }},{ 179,new char[3]{'1','7','9' }},
            { 180,new char[3]{'1','8','0' }},{ 181,new char[3]{'1','8','1' }},{ 182,new char[3]{'1','8','2' }},{ 183,new char[3]{'1','8','3' }},
            { 184,new char[3]{'1','8','4' }},{ 185,new char[3]{'1','8','5' }},{ 186,new char[3]{'1','8','6' }},{ 187,new char[3]{'1','8','7' }},
            { 188,new char[3]{'1','8','8' }},{ 189,new char[3]{'1','8','9' }},{ 190,new char[3]{'1','9','0' }},{ 191,new char[3]{'1','9','1' }},
            { 192,new char[3]{'1','9','2' }},{ 193,new char[3]{'1','9','3' }},{ 194,new char[3]{'1','9','4' }},{ 195,new char[3]{'1','9','5' }},
            { 196,new char[3]{'1','9','6' }},{ 197,new char[3]{'1','9','7' }},{ 198,new char[3]{'1','9','8' }},{ 199,new char[3]{'1','9','9' }},
            { 200,new char[3]{'2','0','0' }},{ 201,new char[3]{'2','0','1' }},{ 202,new char[3]{'2','0','2' }},{ 203,new char[3]{'2','0','3' }},
            { 204,new char[3]{'2','0','4' }},{ 205,new char[3]{'2','0','5' }},{ 206,new char[3]{'2','0','6' }},{ 207,new char[3]{'2','0','7' }},
            { 208,new char[3]{'2','0','8' }},{ 209,new char[3]{'2','0','9' }},{ 210,new char[3]{'2','1','0' }},{ 211,new char[3]{'2','1','1' }},
            { 212,new char[3]{'2','1','2' }},{ 213,new char[3]{'2','1','3' }},{ 214,new char[3]{'2','1','4' }},{ 215,new char[3]{'2','1','5' }},
            { 216,new char[3]{'2','1','6' }},{ 217,new char[3]{'2','1','7' }},{ 218,new char[3]{'2','1','8' }},{ 219,new char[3]{'2','1','9' }},
            { 220,new char[3]{'2','2','0' }},{ 221,new char[3]{'2','2','1' }},{ 222,new char[3]{'2','2','2' }},{ 223,new char[3]{'2','2','3' }},
            { 224,new char[3]{'2','2','4' }},{ 225,new char[3]{'2','2','5' }},{ 226,new char[3]{'2','2','6' }},{ 227,new char[3]{'2','2','7' }},
            { 228,new char[3]{'2','2','8' }},{ 229,new char[3]{'2','2','9' }},{ 230,new char[3]{'2','3','0' }},{ 231,new char[3]{'2','3','1' }},
            { 232,new char[3]{'2','3','2' }},{ 233,new char[3]{'2','3','3' }},{ 234,new char[3]{'2','3','4' }},{ 235,new char[3]{'2','3','5' }},
            { 236,new char[3]{'2','3','6' }},{ 237,new char[3]{'2','3','7' }},{ 238,new char[3]{'2','3','8' }},{ 239,new char[3]{'2','3','9' }},
            { 240,new char[3]{'2','4','0' }},{ 241,new char[3]{'2','4','1' }},{ 242,new char[3]{'2','4','2' }},{ 243,new char[3]{'2','4','3' }},
            { 244,new char[3]{'2','4','4' }},{ 245,new char[3]{'2','4','5' }},{ 246,new char[3]{'2','4','6' }},{ 247,new char[3]{'2','4','7' }},
            { 248,new char[3]{'2','4','8' }},{ 249,new char[3]{'2','4','9' }},{ 250,new char[3]{'2','5','0' }},{ 251,new char[3]{'2','5','1' }},
            { 252,new char[3]{'2','5','2' }},{ 253,new char[3]{'2','5','3' }},{ 254,new char[3]{'2','5','4' }},{ 255,new char[3]{'2','5','5' }}
        };
        private static Dictionary<byte, string> mapEncode = new Dictionary<byte, string>(){
            { 0,"000"},{ 1,"001"},{ 2,"002"},{ 3,"003"},{ 4,"004"},{ 5,"005"},{ 6,"006"},{ 7,"007"},
            { 8,"008"},{ 9,"009"},{ 10,"010"},{ 11,"011"},{ 12,"012"},{ 13,"013"},{ 14,"014"},{ 15,"015"},
            { 16,"016"},{ 17,"017"},{ 18,"018"},{ 19,"019"},{ 20,"020"},{ 21,"021"},{ 22,"022"},{ 23,"023"},
            { 24,"024"},{ 25,"025"},{ 26,"026"},{ 27,"027"},{ 28,"028"},{ 29,"029"},{ 30,"030"},{ 31,"031"},
            { 32,"032"},{ 33,"033"},{ 34,"034"},{ 35,"035"},{ 36,"036"},{ 37,"037"},{ 38,"038"},{ 39,"039"},
            { 40,"040"},{ 41,"041"},{ 42,"042"},{ 43,"043"},{ 44,"044"},{ 45,"045"},{ 46,"046"},{ 47,"047"},
            { 48,"048"},{ 49,"049"},{ 50,"050"},{ 51,"051"},{ 52,"052"},{ 53,"053"},{ 54,"054"},{ 55,"055"},
            { 56,"056"},{ 57,"057"},{ 58,"058"},{ 59,"059"},{ 60,"060"},{ 61,"061"},{ 62,"062"},{ 63,"063"},
            { 64,"064"},{ 65,"065"},{ 66,"066"},{ 67,"067"},{ 68,"068"},{ 69,"069"},{ 70,"070"},{ 71,"071"},
            { 72,"072"},{ 73,"073"},{ 74,"074"},{ 75,"075"},{ 76,"076"},{ 77,"077"},{ 78,"078"},{ 79,"079"},
            { 80,"080"},{ 81,"081"},{ 82,"082"},{ 83,"083"},{ 84,"084"},{ 85,"085"},{ 86,"086"},{ 87,"087"},
            { 88,"088"},{ 89,"089"},{ 90,"090"},{ 91,"091"},{ 92,"092"},{ 93,"093"},{ 94,"094"},{ 95,"095"},
            { 96,"096"},{ 97,"097"},{ 98,"098"},{ 99,"099"},{ 100,"100"},{ 101,"101"},{ 102,"102"},{ 103,"103"},
            { 104,"104"},{ 105,"105"},{ 106,"106"},{ 107,"107"},{ 108,"108"},{ 109,"109"},{ 110,"110"},{ 111,"111"},
            { 112,"112"},{ 113,"113"},{ 114,"114"},{ 115,"115"},{ 116,"116"},{ 117,"117"},{ 118,"118"},{ 119,"119"},
            { 120,"120"},{ 121,"121"},{ 122,"122"},{ 123,"123"},{ 124,"124"},{ 125,"125"},{ 126,"126"},{ 127,"127"},
            { 128,"128"},{ 129,"129"},{ 130,"130"},{ 131,"131"},{ 132,"132"},{ 133,"133"},{ 134,"134"},{ 135,"135"},
            { 136,"136"},{ 137,"137"},{ 138,"138"},{ 139,"139"},{ 140,"140"},{ 141,"141"},{ 142,"142"},{ 143,"143"},
            { 144,"144"},{ 145,"145"},{ 146,"146"},{ 147,"147"},{ 148,"148"},{ 149,"149"},{ 150,"150"},{ 151,"151"},
            { 152,"152"},{ 153,"153"},{ 154,"154"},{ 155,"155"},{ 156,"156"},{ 157,"157"},{ 158,"158"},{ 159,"159"},
            { 160,"160"},{ 161,"161"},{ 162,"162"},{ 163,"163"},{ 164,"164"},{ 165,"165"},{ 166,"166"},{ 167,"167"},
            { 168,"168"},{ 169,"169"},{ 170,"170"},{ 171,"171"},{ 172,"172"},{ 173,"173"},{ 174,"174"},{ 175,"175"},
            { 176,"176"},{ 177,"177"},{ 178,"178"},{ 179,"179"},{ 180,"180"},{ 181,"181"},{ 182,"182"},{ 183,"183"},
            { 184,"184"},{ 185,"185"},{ 186,"186"},{ 187,"187"},{ 188,"188"},{ 189,"189"},{ 190,"190"},{ 191,"191"},
            { 192,"192"},{ 193,"193"},{ 194,"194"},{ 195,"195"},{ 196,"196"},{ 197,"197"},{ 198,"198"},{ 199,"199"},
            { 200,"200"},{ 201,"201"},{ 202,"202"},{ 203,"203"},{ 204,"204"},{ 205,"205"},{ 206,"206"},{ 207,"207"},
            { 208,"208"},{ 209,"209"},{ 210,"210"},{ 211,"211"},{ 212,"212"},{ 213,"213"},{ 214,"214"},{ 215,"215"},
            { 216,"216"},{ 217,"217"},{ 218,"218"},{ 219,"219"},{ 220,"220"},{ 221,"221"},{ 222,"222"},{ 223,"223"},
            { 224,"224"},{ 225,"225"},{ 226,"226"},{ 227,"227"},{ 228,"228"},{ 229,"229"},{ 230,"230"},{ 231,"231"},
            { 232,"232"},{ 233,"233"},{ 234,"234"},{ 235,"235"},{ 236,"236"},{ 237,"237"},{ 238,"238"},{ 239,"239"},
            { 240,"240"},{ 241,"241"},{ 242,"242"},{ 243,"243"},{ 244,"244"},{ 245,"245"},{ 246,"246"},{ 247,"247"},
            { 248,"248"},{ 249,"249"},{ 250,"250"},{ 251,"251"},{ 252,"252"},{ 253,"253"},{ 254,"254"},{ 255,"255"}}
            ;
        private static Dictionary<string, byte> mapDEncode = new Dictionary<string, byte>(){
            {"000", 0},{"001", 1},{"002", 2},{"003", 3},{"004", 4},{"005", 5},{"006", 6},{"007", 7},
            {"008", 8},{"009", 9},{"010", 10},{"011", 11},{"012", 12},{"013", 13},{"014", 14},{"015", 15},
            {"016", 16},{"017", 17},{"018", 18},{"019", 19},{"020", 20},{"021", 21},{"022", 22},{"023", 23},
            {"024", 24},{"025", 25},{"026", 26},{"027", 27},{"028", 28},{"029", 29},{"030", 30},{"031", 31},
            {"032", 32},{"033", 33},{"034", 34},{"035", 35},{"036", 36},{"037", 37},{"038", 38},{"039", 39},
            {"040", 40},{"041", 41},{"042", 42},{"043", 43},{"044", 44},{"045", 45},{"046", 46},{"047", 47},
            {"048", 48},{"049", 49},{"050", 50},{"051", 51},{"052", 52},{"053", 53},{"054", 54},{"055", 55},
            {"056", 56},{"057", 57},{"058", 58},{"059", 59},{"060", 60},{"061", 61},{"062", 62},{"063", 63},
            {"064", 64},{"065", 65},{"066", 66},{"067", 67},{"068", 68},{"069", 69},{"070", 70},{"071", 71},
            {"072", 72},{"073", 73},{"074", 74},{"075", 75},{"076", 76},{"077", 77},{"078", 78},{"079", 79},
            {"080", 80},{"081", 81},{"082", 82},{"083", 83},{"084", 84},{"085", 85},{"086", 86},{"087", 87},
            {"088", 88},{"089", 89},{"090", 90},{"091", 91},{"092", 92},{"093", 93},{"094", 94},{"095", 95},
            {"096", 96},{"097", 97},{"098", 98},{"099", 99},{"100", 100},{"101", 101},{"102", 102},{"103", 103},
            {"104", 104},{"105", 105},{"106", 106},{"107", 107},{"108", 108},{"109", 109},{"110", 110},{"111", 111},
            {"112", 112},{"113", 113},{"114", 114},{"115", 115},{"116", 116},{"117", 117},{"118", 118},{"119", 119},
            {"120", 120},{"121", 121},{"122", 122},{"123", 123},{"124", 124},{"125", 125},{"126", 126},{"127", 127},
            {"128", 128},{"129", 129},{"130", 130},{"131", 131},{"132", 132},{"133", 133},{"134", 134},{"135", 135},
            {"136", 136},{"137", 137},{"138", 138},{"139", 139},{"140", 140},{"141", 141},{"142", 142},{"143", 143},
            {"144", 144},{"145", 145},{"146", 146},{"147", 147},{"148", 148},{"149", 149},{"150", 150},{"151", 151},
            {"152", 152},{"153", 153},{"154", 154},{"155", 155},{"156", 156},{"157", 157},{"158", 158},{"159", 159},
            {"160", 160},{"161", 161},{"162", 162},{"163", 163},{"164", 164},{"165", 165},{"166", 166},{"167", 167},
            {"168", 168},{"169", 169},{"170", 170},{"171", 171},{"172", 172},{"173", 173},{"174", 174},{"175", 175},
            {"176", 176},{"177", 177},{"178", 178},{"179", 179},{"180", 180},{"181", 181},{"182", 182},{"183", 183},
            {"184", 184},{"185", 185},{"186", 186},{"187", 187},{"188", 188},{"189", 189},{"190", 190},{"191", 191},
            {"192", 192},{"193", 193},{"194", 194},{"195", 195},{"196", 196},{"197", 197},{"198", 198},{"199", 199},
            {"200", 200},{"201", 201},{"202", 202},{"203", 203},{"204", 204},{"205", 205},{"206", 206},{"207", 207},
            {"208", 208},{"209", 209},{"210", 210},{"211", 211},{"212", 212},{"213", 213},{"214", 214},{"215", 215},
            {"216", 216},{"217", 217},{"218", 218},{"219", 219},{"220", 220},{"221", 221},{"222", 222},{"223", 223},
            {"224", 224},{"225", 225},{"226", 226},{"227", 227},{"228", 228},{"229", 229},{"230", 230},{"231", 231},
            {"232", 232},{"233", 233},{"234", 234},{"235", 235},{"236", 236},{"237", 237},{"238", 238},{"239", 239},
            {"240", 240},{"241", 241},{"242", 242},{"243", 243},{"244", 244},{"245", 245},{"246", 246},{"247", 247},
            {"248", 248},{"249", 249},{"250", 250},{"251", 251},{"252", 252},{"253", 253},{"254", 254},{"255", 255}
        };

        #endregion
        #region // 字串加解密
        /// <summary>
        /// 對字串加密
        /// </summary>
        /// <param name="sData">被加密的字串</param>
        /// <param name="key">Key</param>
        /// <returns>加密後的字串</returns>
        public static string EncryptString(string sData, string key)
        {
            byte[] ret = Encrypt((new UnicodeEncoding()).GetBytes(sData), key);
            //char[] carr = new char[ret.Length * 3];
            //Span<char> spanarr = carr.AsSpan();
            //sbyte.
            StringBuilder sbRet = new StringBuilder(ret.Length * 3);
            //int idx = 0;
            foreach (byte data in ret)
            {
                //carr[idx++] = mapEncodeSpan[data][0];
                //carr[idx++] = mapEncodeSpan[data][1];
                //carr[idx++] = mapEncodeSpan[data][2];
                sbRet.Append(mapEncode[data]);// data.ToString("000"));
            }
            return sbRet.ToString();
            //return new string(carr);// string.Concat( carr.ToString();
        }
        /// <summary>
        /// 
        /// </summary>
        /// <param name="sData"></param>
        /// <param name="key"></param>
        /// <returns></returns>
        public static string DecryptString(string sData, string key)
        {
            byte[] input = new Byte[sData.Length / 3];
            ReadOnlySpan<char> spanData = sData.AsSpan();
            try
            {
                int idx = 0;
                for (int i = 0; i < input.Length; i++)
                {
                    input[i] = mapDEncode[spanData.Slice(idx, 3).ToString()];//.Substring(i * 3, 3)]; // byte.Parse(sData.Substring(i * 3, 3));
                    idx += 3;
                }
            }
            catch (Exception e5)
            {
                string s1 = e5.Message;
                s1 = e5.Message;
                return "";
            }

            byte[] ret = Decrypt(input, key);
            return (new UnicodeEncoding()).GetString(ret);

        }
        #endregion

        #region // Byte Level 加解密
        private static Dictionary<string, ICryptoTransform> mapDeser = new Dictionary<string, ICryptoTransform>();
        /// <summary>
        /// 
        /// </summary>
        /// <param name="byteData"></param>
        /// <param name="key"></param>
        /// <returns></returns>
        public static byte[] Encrypt(byte[] byteData, string key)
        {
            MemoryStream ms = new MemoryStream();

            ICryptoTransform tdes = null;
            if (mapDeser.ContainsKey(key) == true)
            {
                tdes = mapDeser[key];
            }
            else
            {
                TripleDESCryptoServiceProvider DES = new TripleDESCryptoServiceProvider();
                MD5CryptoServiceProvider hashMD5 = new MD5CryptoServiceProvider();
                DES.Key = hashMD5.ComputeHash(ASCIIEncoding.ASCII.GetBytes(key));
                DES.Mode = CipherMode.ECB;
                tdes = DES.CreateEncryptor();
                mapDeser.Add(key, tdes);
            }


            CryptoStream encStream = new CryptoStream(ms, tdes, CryptoStreamMode.Write);

            encStream.Write(byteData, 0, byteData.Length);
            encStream.Close();
            return ms.ToArray();
        }
        /// <summary>
        /// 
        /// </summary>
        /// <param name="byteData"></param>
        /// <param name="key"></param>
        /// <returns></returns>
        public static byte[] Decrypt(byte[] byteData, string key)
        {
            try
            {
                MemoryStream ms = new MemoryStream();

                TripleDESCryptoServiceProvider DES = new TripleDESCryptoServiceProvider();
                MD5CryptoServiceProvider hashMD5 = new MD5CryptoServiceProvider();

                DES.Key = hashMD5.ComputeHash(ASCIIEncoding.ASCII.GetBytes(key));
                DES.Mode = CipherMode.ECB;

                ICryptoTransform tdes = DES.CreateDecryptor();
                CryptoStream decStream = new CryptoStream(ms, tdes, CryptoStreamMode.Write);

                decStream.Write(byteData, 0, byteData.Length);
                decStream.Close();

                return ms.ToArray();
            }
            catch
            {
                return new byte[] { 0 };
            }
        }
        #endregion

    }
}
